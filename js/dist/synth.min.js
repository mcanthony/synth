var Synth=function(container,control,cam,json){var that=this;this.control=control,this.cam=cam,this.container=container,this.camera,this.scene,this.renderer,this.texture,this.material,this.mesh,this.detail=480,this.hd=!0,this.back,this.fill,this.key,this.composer,this.renderModel,this.effectBloom,this.effectHue,this.effectCopy,this.mouseX=0,this.mouseY=0,this.windowHalfX=window.innerWidth/2,this.windowHalfY=window.innerHeight/2,this.videoPlayer=document.getElementById("videoplayer"),this.videoInput=document.getElementById("video"),this.videoInput.current=0,this.canvasInput=document.getElementById("compare"),this.videoObject,this.videoisplaying=!1,this.vplaylist=[],this.aplaylist=[],this.audioInput=document.getElementById("audio"),this.audioInput.current=0,this.audioisplaying=!1,this.audiostream=[],this.dancer=new Dancer,this.dropZone=document.getElementById("drop_zone"),this.readFiles=document.getElementById("read_files"),this.dropZoneVideo=document.getElementById("video_drop"),this.readFilesVideo=document.getElementById("read_video"),this.webcam=!1,this.guiSetup=!1,this.initComplete=!1,this.menusEnabled=!0,this.controls=!1,this.pointer=[],this.setting=[],this.trigger=!1,this.mousex=that.mouseX,this.mousey=that.mouseY,this.shape="",this.meshUpdate=!1,this.wireframe=!1,this.camerax=0,this.cameray=-1130,this.cameraz=1680,this.scale=5,this.multiplier=1,this.displace=1,this.transparency=.8,this.originX=0,this.originY=0,this.originZ=-2e3,this.hue=0,this.saturation=.9,this.bgColor="#000000",this.guiContainer,this.setting.current=0,this.presets=[];for(var pointers=0;16>pointers;pointers++)this.pointer.push(0);this.res=new res([{state:"portrait",breakpoint:420,cols:4,margin:10,gutter:10},{state:"landscape",breakpoint:640,cols:4,margin:10,gutter:10},{state:"tablet",breakpoint:768,cols:12,margin:40,gutter:10},{state:"small",breakpoint:1024,cols:12,margin:40,gutter:10},{state:"medium",breakpoint:1440,cols:16,margin:80,gutter:20},{state:"large",breakpoint:1920,cols:16,margin:80,gutter:20},{state:"retina",breakpoint:3840,cols:16,margin:160,gutter:40}]),this.init(json)};Synth.prototype={get settings(){return{camera:this.camerax+","+this.cameray+","+this.cameraz,shape:this.shape,detail:this.detail,scale:this.scale,wireframe:this.wireframe,multiplier:this.multiplier,displace:this.displace,origin:this.originX+","+this.originY+","+this.originZ,opacity:this.transparency,hue:this.hue,saturation:this.saturation,bgColor:this.bgColor}},get displacement(){return this.displace},set displacement(val){this.displace=val},get multiply(){return this.multiplier},set multiply(val){this.multiplier=val},get scaler(){return this.scale},set scaler(val){this.mesh.scale.x=this.mesh.scale.y=this.scale=parseFloat(val)},get oX(){return this.originX},set oX(pos){this.cameraX=parseFloat(pos)},get oY(){return this.originY},set oY(pos){this.originY=parseFloat(pos)},get oZ(){return this.originZ},set oZ(pos){this.originZ=parseFloat(pos)},get originPos(){return this.originX+","+this.originY+","+this.originZ},get originArray(){return[this.originX,this.originY,this.originZ]},set originPos(pos){var coords=pos.split(",");this.originX=parseFloat(coords[0]),this.originY=parseFloat(coords[1]),this.originZ=parseFloat(coords[2])},get camX(){return this.camera.position.x},set camX(pos){this.camerax=this.camera.position.x=parseFloat(pos)},get camY(){return this.camera.position.y},set camY(pos){this.cameray=this.camera.position.y=parseFloat(pos)},get camZ(){return this.camera.position.y},set camZ(pos){this.cameraz=this.camera.position.z=parseFloat(pos)},get cameraPos(){return this.camera.position.x+","+this.camera.position.y+","+this.camera.position.z},get cameraArray(){return[this.camera.position.x,this.camera.position.y,this.camera.position.z]},set cameraPos(pos){var coords=pos.split(",");this.camerax=this.camera.position.x=parseFloat(coords[0]),this.cameray=this.camera.position.y=parseFloat(coords[1]),this.cameraz=this.camera.position.z=parseFloat(coords[2])},get model(){return this.shape},set model(shape){("plane"===shape||"cube"===shape||"torus"===shape||"sphere"===shape||"cylinder"===shape)&&this.meshChange(shape,that.detail,that.detail)},get color(){return this.hue},set color(val){this.hue=val},get saturate(){return this.saturation},set saturate(val){this.saturation=val},get opacity(){return this.transparency},set opacity(val){this.transparency=val},get bg(){return this.bgColor},set bg(val){var that=this;this.bgColor=val,$("#canvas").css("background-color",that.bgColor);var newhex=parseInt(that.bgColor.replace("#","0x"));this.renderer.setClearColor(newhex,1)},get wire(){return this.wireframe},set wire(val){this.wireframe===!1&&this.videoMaterial.wireframe===!1&&val===!0?(this.videoMaterial.wireframe=!0,this.wireframe=!0):(this.videoMaterial.wireframe=!1,this.wireframe=!1)},get channel(){return this.webcam},set channel(val){this.webcam===!1&&val===!0?(this.videoInput.src=this.videoObject,this.webcam=!0):(this.playVideo(this.currentVideo),this.webcam=!1)},get menu(){return this.menusEnabled},set menu(val){this.menusEnabled===!1&&val===!0?($("#close_drop,#gui_drop,.close-button,#topfill").show(),this.menusEnabled=!0):($("#close_drop,#gui_drop,.close-button,#topfill").hide(),this.menusEnabled=!1)},init:function(json){function onWindowResize(){that.camera.aspect=window.innerWidth/window.innerHeight,that.camera.updateProjectionMatrix(),that.renderer.setSize(window.innerWidth,window.innerHeight),that.composer.reset()}function animate(){requestAnimationFrame(animate),that.render()}var that=this;window.URL=window.URL||window.webkitURL,document.body.appendChild(that.container),this.camera=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,1e4),this.scene=new THREE.Scene,this.texture=new THREE.Texture(that.videoInput),this.texture.minFilter=THREE.LinearFilter,this.texture.magFilter=THREE.LinearFilter,this.texture.format=THREE.RGBFormat,this.texture.generateMipmaps=!0,this.videoMaterial=new THREE.ShaderMaterial({uniforms:{tDiffuse:{type:"t",value:that.texture},multiplier:{type:"f",value:that.multiplier},displace:{type:"f",value:that.displace},opacity:{type:"f",value:that.opacity},originX:{type:"f",value:that.originArray[0]},originY:{type:"f",value:that.originArray[1]},originZ:{type:"f",value:that.originArray[2]}},vertexShader:RuttEtraShader.vertexShader,fragmentShader:RuttEtraShader.fragmentShader,depthWrite:!0,depthTest:!0,wireframe:that.wireframe,transparent:!0,overdraw:!1}),this.videoMaterial.renderToScreen=!1,this.videoMaterial.wireframe=that.wireframe,this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.autoClear=!1,this.container.appendChild(that.renderer.domElement),this.composer=new THREE.EffectComposer(that.renderer),this.renderModel=new THREE.RenderPass(that.scene,that.camera),this.composer.addPass(that.renderModel),this.effectHue=new THREE.ShaderPass(THREE.HueSaturationShader),this.effectHue.renderToScreen=!0,this.effectHue.uniforms.hue.value=0,this.effectHue.uniforms.saturation.value=0,this.composer.addPass(that.effectHue),this.fill=new THREE.AmbientLight(7368816),this.scene.add(that.fill),this.key=new THREE.SpotLight(16777215),this.key.position.set(0,0,5e3).normalize(),this.key.target=this.mesh,this.key.intensity=5e3,this.key.castShadow=!0,this.scene.add(that.key),this.back=new THREE.SpotLight(16777215),this.back.position.set(0,0,-5e3).normalize(),this.back.target=this.mesh,this.back.intensity=5e3,this.back.castShadow=!0,this.scene.add(that.back),window.addEventListener("resize",onWindowResize,!1),this.control===!0&&this.initControls(),this.cam===!0&&this.initWebcam(),that.setDefaults(json,0),that.initComplete=!0,animate()},createWebcamItem:function(){var that=this,li=document.createElement("li"),correctName="camera";correctName.length>30&&(correctName=correctName.substring(0,30)),li.innerHTML=['<a class="track" href="#" data-href="',"#",'" data-title="',correctName,'">',correctName,"</a>"].join(""),document.getElementById("videoplaylist").insertBefore(li,null);{var nodeList=Array.prototype.slice.call(document.getElementById("videoplaylist").children);nodeList.indexOf(0)}li.onclick=function(){that.webcam===!1&&(that.channel=!0,$("#close_drop").trigger("click"))}},initWebcam:function(){var that=this,message="";console.log("init Webcam!"),Modernizr.getusermedia&&"firefox"!==that.res.browser?(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({video:!0,audio:!1},function(stream){if(navigator.mozGetUserMedia);else{var vendorURL=window.URL||window.webkitURL;that.webcam=!0,that.videoObject=vendorURL.createObjectURL(stream),that.videoInput.src=that.videoObject,that.createWebcamItem()}},function(){message="Unable to capture WebCam. Please reload the page or try with Google Chrome."})):"desktop"===this.res.device?("firefox"===this.res.browser&&(message="Use the controls to distort the video."),"safari"===this.res.browser&&(message="Use the controls to distort the video.")):("ipad"===this.res.device&&(message="Use the controls to distort the video."),"iphone"===this.res.device&&(message="Video playback is not supported inline on iPhone."),"android"===this.res.device&&(message="Your browser is not supported. Please try again with Google Chrome on a desktop computer.")),"chrome"===this.res.browser&&(message="Drag and drop music and video, use the controls to distort the video."),"firefox"===this.res.browser&&(message="Use the controls to distort the video."),setTimeout(function(){$("header h2").text(message)},3800),that.webcam===!1&&that.playVideo(0)},convertToRange:function(value,srcRange,dstRange){if(value<srcRange[0]||value>srcRange[1])return 0/0;var srcMax=parseFloat(srcRange[1])-parseFloat(srcRange[0]),dstMax=parseFloat(dstRange[1])-parseFloat(dstRange[0]),adjValue=parseFloat(value)-parseFloat(srcRange[0]);return parseFloat(adjValue)*parseFloat(dstMax)/parseFloat(srcMax)+parseFloat(dstRange[0])},convertTo3dCoords:function(x,y,w,h,m){var nx=m*x/w-1,ny=-m*y/h+1;return{x:nx,y:ny}},initControls:function(){function rgbToHex(R,G,B){return toHex(R)+toHex(G)+toHex(B)}function toHex(n){return n=parseInt(n,10),isNaN(n)?"00":(n=Math.max(0,Math.min(n,255)),"0123456789ABCDEF".charAt((n-n%16)/16)+"0123456789ABCDEF".charAt(n%16))}function updateValue(obj,val){obj.html(val),console.log(val)}var that=this,keylistener=new window.keypress.Listener;$("#gui_container").show(),$("#container").show();var value,value2,round,start,end,width,height,control,key1,key2,json,coords;$(".xy").draggable({containment:"parent",start:function(){key1=$(this).data("key1"),key2=$(this).data("key2"),value=$(this).data("value"),start=$(this).data("start"),width=$(this).parent(".wrapper").parent(".joystick").width(),height=$(this).parent(".wrapper").parent(".joystick").height(),end=$(this).data("end")},drag:function(){control=$(this).position(),control.top<height&&control.top>0&&(value=that.convertToRange(control.top,[0,height],[start,end])),control.left<width&&control.left>0&&(value2=that.convertToRange(control.left,[0,width],[start,end])),coords=that.convertTo3dCoords(value,value2,window.innerWidth,window.innerHeight,$(this).data("multiply")),eval("that."+key1+"="+coords.x),eval("that."+key2+"="+coords.y)},stop:function(){control=$(this).position(),control.top<height&&control.top>0&&(value=that.convertToRange(control.top,[0,height],[start,end])),control.left<width&&control.left>0&&(value2=that.convertToRange(control.left,[0,width],[start,end])),coords=that.convertTo3dCoords(value,value2,window.innerWidth,window.innerHeight,$(this).data("multiply")),eval("that."+key1+"="+coords.x),eval("that."+key2+"="+coords.y)}});var scale,posX,posY;$(".vert").draggable({axis:"y",containment:"parent",start:function(){key=$(this).data("key"),value=$(this).data("value"),start=$(this).data("start"),width=$(this).parent(".wrapper").parent(".fader").height()-$(this).height(),end=$(this).data("end")},drag:function(){control=$(this).position(),control.top<width&&control.top>=0&&(value=that.convertToRange(control.top,[0,width],[start,end]),json='{ "'+key+'" : '+value+" }",eval("that."+key+"="+value))},stop:function(){control=$(this).position(),value=that.convertToRange(control.top,[0,width],[start,end]),json='{ "'+key+'" : '+value+" }",eval("that."+key+"="+value)}}),$(".hor").draggable({axis:"x",containment:"parent",start:function(){key=$(this).data("key"),value=$(this).data("value"),start=$(this).data("start"),width=$(this).parent(".wrapper").parent(".fader").width()-$(this).height(),end=$(this).data("end")},drag:function(){control=$(this).position(),control.left<width&&control.left>=0&&(value=that.convertToRange(control.left,[0,width],[start,end]),json='{ "'+key+'" : '+value+" }",eval("that."+key+"="+value))},stop:function(){control=$(this).position(),control.left<width&&control.left>=0&&(value=that.convertToRange(control.left,[0,width],[start,end]),json='{ "'+key+'" : '+value+" }",eval("that."+key+"="+value))}}),$(".toggle.model").on("click",function(){$(this).hasClass("active")||($(".toggle.model").removeClass("active"),$(this).addClass("active"),that.detail=$("input#detail_value").val(),eval("that.meshChange('"+$(this).children("control").data("key")+"','"+that.detail+"','"+that.detail+"')"))}),$(".toggle.wire").on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),eval("that.wire = false")):($(this).addClass("active"),eval("that.wire = true"))}),$(".bars li").on("click",function(){$(this).hasClass("controller")||that.audioisplaying!==!0?$(this).removeClass("controller"):(that.trigger=!0,eval(that.setting.current=$(this).index()),that.setting.push($(this).index()),$(this).attr("data-index",that.setting.length),setTimeout(function(){that.trigger=!1},1e4),$(this).addClass("controller"))}),$(".control").on("click",function(){that.trigger!==!0||$(this).hasClass("controller")||($(this).css("top",that.pointer[that.setting.current]+"px"),$(this).attr("data-index",that.setting.current),$(this).addClass("controlled"),$(this).parent().prepend('<div class="close red"></div>'),$(this).parent().children(".close").on("click",function(){$(this).parent().children(".control").removeClass("controlled"),$(".bars li:eq("+$(this).parent().children(".control").data("index")+")").removeClass("controller"),$(this).remove()}))}),Modernizr.filesystem?(this.dropZone.context=this,this.readFiles.context=this,this.dropZoneVideo.context=this,this.readFilesVideo.context=this,this.dropZone.addEventListener("dragover",that.handleDragOver,!1),this.dropZone.ondrop=function(evt){that.handleFileSelect(evt,"audio",that)},this.readFiles.onmousedown=function(evt){that.readFileSelect(evt,"audio"),$("#read_files").fadeOut(1e3)},this.dropZoneVideo.addEventListener("dragover",that.handleDragOver,!1),this.dropZoneVideo.ondrop=function(evt){that.handleFileSelect(evt,"video",that)},this.readFilesVideo.onmousedown=function(evt){that.readFileSelect(evt,"video"),$("#read_video").fadeOut(1e3)},window.File&&window.FileReader&&window.FileList&&window.Blob&&(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,that.fetchPresets()),$('<div id="close_drop"><p>Close Playlist</p></div>').insertAfter("audio")):$("#close_drop,#video_drop,#drop_zone,audio,.equalizer").hide(),$('<div id="preset_selector"><ul></ul></div>').insertBefore("#container"),$('<div id="gui_drop"><p>Close Controls</p></div>').insertBefore("#preset_selector");for(var pre=0;9>pre;pre++){var number=pre+1;$("#preset_selector ul").append('<li class="preset" data-index="'+pre+'"><span>'+number+"</span></li>")}$("#preset_selector ul").append('<li class="save"><span>Save</span></li>'),$("#preset_selector ul").append('<li class="clear"><span>Clear</span></li>'),$("#preset_selector ul li.preset").on("click",function(){that.setPreset($(this).index())}),$("#preset_selector ul li.save").on("click",function(){Modernizr.filesystem&&that.saveOverPresets()}),$("#preset_selector ul li.clear").on("click",function(){that.removePresets()}),$(".close-button").on("click",function(){that.controls===!1?(that.controls=!0,$(".close-button").addClass("active")):(that.controls=!1,$(".close-button").removeClass("active"))}),$("#close_drop").on("click",function(){$(this).toggleClass("active"),$("header").fadeOut(8e3),$(this).is(".active")?($("#drop_zone").hide(),$("#video_drop").hide(),$("audio").css("top","20px"),$("audio").hide(),$(this).css("top","0px"),$(this).children("p").text("Open Playlist")):$(this).not(".active")&&($("#drop_zone").show(),$("#video_drop").show(),$("audio").show(),$("audio").css("top","318px"),$(this).css("top","298px"),$(this).children("p").text("Close Playlist"))}),$("#gui_drop").on("click",function(){$(this).toggleClass("active"),$("header").fadeOut(8e3),$(this).is(".active")?($("#container").hide(),$("#preset_selector").hide(),$(this).css("bottom","0px"),$(this).children("p").text("Open Controls")):$(this).not(".active")&&($("#container").show(),$("#preset_selector").show(),"ipad"===that.res.device?$(this).css("bottom","43%"):$(this).css("bottom","36%"),$(this).children("p").text("Close Controls"))}),$("input#detail_value").on("focus",function(){keylistener.stop_listening()}),$("input#detail_value").on("blur",function(){keylistener.listen(),that.detail=$(this).val()}),$("input").on("keyup",function(e){13==e.keyCode&&$(this).blur()}),$("input.number").keydown(function(event){46==event.keyCode||8==event.keyCode||9==event.keyCode||27==event.keyCode||13==event.keyCode||65==event.keyCode&&event.ctrlKey===!0||event.keyCode>=35&&event.keyCode<=39||(event.shiftKey||(event.keyCode<48||event.keyCode>57)&&(event.keyCode<96||event.keyCode>105))&&event.preventDefault()}),"ipad"===that.res.device?($("#container,#gui_drop,#preset_selector").css("width","864px").css("margin-left","-432px"),$("#container").css("height","40%"),$("#preset_selector").css("bottom","40%"),$("#gui_drop").css("bottom","43%")):$("#container,#gui_drop,#preset_selector").css("width","1226px").css("margin-left","-613px"),Modernizr.filesystem===!1&&$("#container,#gui_drop,#preset_selector").css("width","864px").css("margin-left","-432px"),document.addEventListener("mousemove",that.onDocumentMouseMove,!1),keylistener.simple_combo("1",function(){that.setPreset(0)}),keylistener.simple_combo("2",function(){that.setPreset(1)}),keylistener.simple_combo("3",function(){that.setPreset(2)}),keylistener.simple_combo("4",function(){that.setPreset(3)}),keylistener.simple_combo("5",function(){that.setPreset(4)}),keylistener.simple_combo("6",function(){that.setPreset(5)}),keylistener.simple_combo("7",function(){that.setPreset(6)}),keylistener.simple_combo("8",function(){that.setPreset(7)}),keylistener.simple_combo("9",function(){that.setPreset(8)}),keylistener.simple_combo("ctrl 1",function(){that.savePresetAtIndex(0)}),keylistener.simple_combo("ctrl 2",function(){that.savePresetAtIndex(1)}),keylistener.simple_combo("ctrl 3",function(){that.savePresetAtIndex(2)}),keylistener.simple_combo("ctrl 4",function(){that.savePresetAtIndex(3)}),keylistener.simple_combo("ctrl 5",function(){that.savePresetAtIndex(4)}),keylistener.simple_combo("ctrl 6",function(){that.savePresetAtIndex(5)}),keylistener.simple_combo("ctrl 7",function(){that.savePresetAtIndex(6)}),keylistener.simple_combo("ctrl 8",function(){that.savePresetAtIndex(7)}),keylistener.simple_combo("ctrl 9",function(){that.savePresetAtIndex(8)}),keylistener.simple_combo("`",function(){that.webcam===!1&&(that.channel=!0)}),keylistener.simple_combo("0",function(){that.cameraPos="0,0,1000",$(".joycam .control").css("top","50%"),$(".joycam .control").css("left","50%")}),keylistener.simple_combo(")",function(){that.originPos="0,0,0",$(".joywarp .control").css("top","50%"),$(".joywarp .control").css("left","50%")}),keylistener.simple_combo("l",function(){that.videoInput.loop=0==that.videoInput.loop?!0:!1});var mouseView=!0;keylistener.simple_combo("y",function(){$(".toggle.model.plane").trigger("click")}),keylistener.simple_combo("u",function(){$(".toggle.model.cube").trigger("click")}),keylistener.simple_combo("i",function(){$(".toggle.model.sphere").trigger("click")}),keylistener.simple_combo("o",function(){$(".toggle.model.cylinder").trigger("click")}),keylistener.simple_combo("p",function(){$(".toggle.model.torus").trigger("click")}),keylistener.simple_combo("x",function(){$("#close_drop").trigger("click"),$("#gui_drop").trigger("click")}),keylistener.simple_combo("m",function(){that.menu((that.menu=!0)?!1:!0)})},playAudio:function(playlistId){var that=this;this.audioisplaying=!1,this.audioInput.pause(),this.audioInput.remove(),this.audioInput=that.container.appendChild(document.createElement("audio")),$("#close_drop").is(".active")?$("audio").hide():$("audio").show(),this.audioInput.id="audio",this.audioInput.controls=!0,this.audioInput.src=this.aplaylist[playlistId],this.dancer.after(0,function(){that.audiostream[0]=Math.round(5e3*this.getFrequency(30)),that.audiostream[1]=Math.round(5e3*this.getFrequency(60)),that.audiostream[2]=Math.round(5e3*this.getFrequency(90)),that.audiostream[3]=Math.round(5e3*this.getFrequency(120)),that.audiostream[4]=Math.round(5e3*this.getFrequency(150)),that.audiostream[5]=Math.round(5e3*this.getFrequency(180)),that.audiostream[6]=Math.round(5e3*this.getFrequency(210)),that.audiostream[7]=Math.round(5e3*this.getFrequency(240)),that.audiostream[8]=Math.round(5e3*this.getFrequency(270)),that.audiostream[9]=Math.round(5e3*this.getFrequency(300)),that.audiostream[10]=Math.round(5e3*this.getFrequency(330))}).load(that.audioInput),this.audioInput.play(),this.dancer.play(),this.audioisplaying=!0,$("#playlist").children("li").css("background-color","rgba(10,10,10,0.7)"),$("#playlist").children("li").eq(playlistId).css("background-color","rgba(10,10,10,0.9)")},continueAudioPlay:function(context){var that=context;that.audioInput.current++;var length=(that.aplaylist,that.aplaylist.length);that.audioInput.current==length?(that.audioInput.current=0,that.playAudio(that.audioInput.current)):that.playAudio(that.audioInput.current),console.log(that.audioInput.current)},continueVideoPlay:function(context){var that=context;console.log(that),that.videoInput.current++;var length=(that.vplaylist,that.vplaylist.length);that.videoInput.current==length?(that.videoInput.current=0,that.playVideo(that.videoInput.current)):that.playVideo(that.videoInput.current)},playVideo:function(playlistId){this.webcam=!1,this.videoInput.pause(),this.videoisplaying=!1,this.videoInput.src=this.vplaylist[playlistId],this.videoInput.muted=!0,this.videoInput.play(),this.videoisplaying=!0,$("#videoplaylist").children("li").css("background-color","rgba(10,10,10,0.7)"),$("#videoplaylist").children("li").eq(playlistId).css("background-color","rgba(10,10,10,0.9)")},defaultVideo:function(url){$("video").attr("src",url),this.videoInput.load(),this.videoInput.loop=!0},toArray:function(list){return Array.prototype.slice.call(list||[],0)},handleDragOver:function(evt){evt.stopPropagation(),evt.preventDefault(),evt.dataTransfer.dropEffect="copy"},errorHandler:function(err){var msg="An error occured: ";switch(err.code){case FileError.NOT_FOUND_ERR:msg+="File or directory not found";break;case FileError.NOT_READABLE_ERR:msg+="File or directory not readable";break;case FileError.PATH_EXISTS_ERR:msg+="File or directory already exists";break;case FileError.TYPE_MISMATCH_ERR:msg+="Invalid filetype";break;default:msg+="Unknown Error"}console.log(msg)},listResults:function(entries,type,context){function entryClickListener(index){"video"===type&&(context.playVideo(index),context.videoInput.onended=function(){context.continueVideoPlay(context)}),"audio"===type&&(context.playAudio(index),context.audioInput.onended=function(){context.continueAudioPlay(context)}),$("#close_drop").trigger("click")}function entryListener(entry,playlist){playlist.push(entry.toURL())}var fragment=document.createDocumentFragment();entries.forEach(function(entry){var li=document.createElement("li"),correctName=(unescape(entry.name),unescape(entry.name));if(correctName.length>30&&(correctName=correctName.substring(0,30)),li.innerHTML=['<a class="track" href="#" data-href="',entry.toURL(),'" data-title="',correctName,'">',correctName,"</a>"].join(""),"video"===type){entryListener(entry,context.vplaylist),document.getElementById("videoplaylist").insertBefore(li,null);var nodeList=Array.prototype.slice.call(document.getElementById("videoplaylist").children)}if("audio"===type){entryListener(entry,context.aplaylist),document.getElementById("playlist").insertBefore(li,null);var nodeList=Array.prototype.slice.call(document.getElementById("playlist").children)}var index=nodeList.indexOf(li);li.onclick=function(){entryClickListener(index)}}),"video"===type&&(document.querySelector("#videoplaylist").appendChild(fragment),$("#video_drop").css("background","rgba(0, 0, 0, 0.6)")),"audio"===type&&(document.querySelector("#playlist").appendChild(fragment),$("#drop_zone").css("background","rgba(0, 0, 0, 0.6)"))},readFileSelect:function(evt,type){evt.stopPropagation(),evt.preventDefault();var that=evt.target.context;window.requestFileSystem(window.TEMPORARY,838860800,function(fs){fs.root.getDirectory(type,{},function(dirEntry){var dirReader=dirEntry.createReader(),entries=[],readEntries=function(){dirReader.readEntries(function(results){results.length?(entries=entries.concat(evt.target.context.toArray(results)),readEntries()):that.listResults(entries.sort(),type,evt.target.context)},evt.target.context.errorHandler)};readEntries()})})},handleFileSelect:function(evt,type,context){function loadEndHandler(context,fileEntry){"video"===type&&that.vplaylist.push(fileEntry.toURL()),"audio"===type&&that.aplaylist.push(fileEntry.toURL()),that.readFileSelect(evt,type)}evt.stopPropagation(),evt.preventDefault();var that=context,files=evt.dataTransfer.files;window.requestFileSystem(window.TEMPORARY,838860800,function(fs){fs.root.getDirectory(type,{create:!0},function(){},that.errorHandler);for(var file,i=0;file=files[i];++i)!function(f){fs.root.getFile("/"+type+"/"+f.name,{create:!0,exclusive:!0},function(fileEntry){fileEntry.createWriter(function(fileWriter){fileWriter.write(f)},that.errorHandler),fileEntry.file(function(file){var reader=new FileReader;reader.onloadend=function(){loadEndHandler(context,fileEntry);var li=document.createElement("li"),correctName=(unescape(fileEntry.name),unescape(fileEntry.name));if(correctName.length>30&&(correctName=correctName.substring(0,30)),li.innerHTML=['<a class="track" href="#" data-href="',fileEntry.toURL(),'" data-title="',correctName,'">',correctName,"</a>"].join(""),"video"===type){document.getElementById("videoplaylist").insertBefore(li,null);var nodeList=Array.prototype.slice.call(document.getElementById("videoplaylist").children),index=nodeList.indexOf(li);li.onclick=function(){that.playVideo(index),$("#close_drop").trigger("click")},$("#video_drop").css("background","rgba(0, 0, 0, 0.6)")}if("audio"===type){document.getElementById("playlist").insertBefore(li,null);var nodeList=Array.prototype.slice.call(document.getElementById("playlist").children),index=nodeList.indexOf(li);li.onclick=function(){that.playAudio(index),$("#close_drop").trigger("click")},$("#drop_zone").css("background","rgba(0, 0, 0, 0.6)")}},reader.readAsDataURL(file)},that.errorHandler)},that.errorHandler)}(file);$("header h2").text("Change controls to achieve stunning new looks."),$("header").delay(8e3).fadeOut(2e3)})},deleteFile:function(name,callback){var that=this;window.requestFileSystem(window.TEMPORARY,838860800,function(fs){fs.root.getFile(name,{create:!1},function(fileEntry){var fn=callback;fileEntry.remove(fn,that.errorHandler)},that.errorHandler)})},setDefaults:function(obj,index){var that=this,json=obj[index];that.originPos=json.origin,that.cameraPos=json.camera,that.detail=json.detail,that.meshChange(json.shape,json.detail,json.detail),that.wire=json.wireframe,that.scaler=json.scale,that.multiply=json.multiplier,that.displacement=json.displace,that.opacity=json.opacity,that.saturate=json.saturation,that.bg=json.bgColor},setPreset:function(index){var that=this,json=that.presets[index];that.originPos=json.origin,that.cameraPos=json.camera,that.detail=json.detail,that.meshChange(json.shape,json.detail,json.detail),that.wire=json.wireframe,that.scaler=json.scale,that.multiply=json.multiplier,that.displacement=json.displace,that.opacity=json.opacity,that.saturate=json.saturation,that.bg=json.bgColor,$("#preset_selector ul li").removeClass("selected"),$("#preset_selector ul li:eq("+index+")").addClass("selected")},savePreset:function(){var that=this;that.presets.push(that.settings),Modernizr.filesystem&&that.saveOverPresets()},removePresets:function(){var that=this;that.presets=[],$("#preset_selector ul li").removeClass("selected")},savePresetAtIndex:function(index){var that=this;that.presets[index]=that.settings,that.saveOverPresets()},saveOverPresets:function(){var that=this;that.deleteFile("/presets.json",that.savePresets())},savePresets:function(){var that=this;window.requestFileSystem(window.TEMPORARY,838860800,function(fs){console.log("Opened file system: ",fs.name),fs.root.getFile("presets.json",{create:!0},function(fileEntry){fileEntry.createWriter(function(fileWriter){console.log(fileWriter),fileWriter.onwriteend=function(){console.log("Write completed.")},fileWriter.onerror=function(e){console.log("Write failed: "+e.toString())};var json=JSON.stringify(that.presets),blob=new Blob([json],{type:"application/json"});fileWriter.write(blob)},that.errorHandler)},that.errorHandler)})},fetchDefaults:function(){var that=this;$.getJSON("js/default.json",function(data){$.each(data,function(key,val){that.presets.push(val)})})},fetchPresets:function(){var that=this;window.requestFileSystem(window.TEMPORARY,838860800,function(fs){console.log("Opened file system: ",fs.name),fs.root.getFile("presets.json",{},function(fileEntry){fileEntry.file(function(file){var reader=new FileReader;reader.onloadend=function(){console.log(this.result),that.presets=JSON.parse(this.result||"[]"),this.result.length>0&&that.setPreset(0)},reader.readAsText(file)},that.errorHandler)},that.errorHandler)})},paramsChange:function(){var that=this;that.mesh.scale.x=that.mesh.scale.y=that.mesh.scale.z=parseFloat(that.scale),that.mousex=that.mouseX,that.mousey=that.mouseY,that.camera.position.x=parseFloat(that.camerax),that.camera.position.y=parseFloat(that.cameray),that.camera.position.z=parseFloat(that.cameraz),that.videoMaterial.uniforms.displace.value=that.displace,that.videoMaterial.uniforms.multiplier.value=that.multiplier,that.videoMaterial.uniforms.opacity.value=parseFloat(that.transparency),that.videoMaterial.uniforms.originX.value=parseFloat(that.originX),that.videoMaterial.uniforms.originY.value=parseFloat(that.originY),that.videoMaterial.uniforms.originZ.value=parseFloat(that.originZ),that.effectHue.uniforms.hue.value=that.hue,that.saturation>=-1&&that.saturation<1?that.effectHue.uniforms.saturation.value=that.saturation:that.saturation<-1?that.effectHue.uniforms.saturation.value=-1:that.saturation>1&&(that.effectHue.uniforms.saturation.value=1),$("#canvas").css("background-color",that.bgColor);var newhex=parseInt(that.bgColor.replace("#","0x"));that.renderer.setClearColor(newhex,1),that.audioisplaying===!0&&($(".in1").css("height",that.audiostream[0]+"%"),eval(that.pointer[$(".in1").index()]=$(".in1").height()),$(".in2").css("height",that.audiostream[1]+"%"),eval(that.pointer[$(".in2").index()]=$(".in2").height()),$(".in3").css("height",that.audiostream[2]+"%"),eval(that.pointer[$(".in3").index()]=$(".in3").height()),$(".in4").css("height",that.audiostream[3]+"%"),eval(that.pointer[$(".in4").index()]=$(".in4").height()),$(".in5").css("height",that.audiostream[4]+"%"),eval(that.pointer[$(".in5").index()]=$(".in5").height()),$(".in6").css("height",that.audiostream[5]+"%"),eval(that.pointer[$(".in6").index()]=$(".in6").height()),$(".in7").css("height",that.audiostream[6]+"%"),eval(that.pointer[$(".in7").index()]=$(".in7").height()),$(".in8").css("height",that.audiostream[7]+"%"),eval(that.pointer[$(".in8").index()]=$(".in8").height()),$(".in9").css("height",that.audiostream[8]+"%"),eval(that.pointer[$(".in9").index()]=$(".in9").height()),$(".in10").css("height",that.audiostream[9]+"%"),eval(that.pointer[$(".in10").index()]=$(".in10").height()),$(".control.controlled").each(function(){var control=$(this).position();
control.top=$(".bars li:eq("+$(this).data("index")+")").height();var value=that.convertToRange(control.top,[0,$(this).parent(".wrapper").parent(".fader").height()-$(this).height()],[$(this).data("start"),$(this).data("end")]),key=$(this).data("key");eval("that."+key+"="+value)}));for(var i=0;4>=i;i++)eval(that.setting[i])},meshChange:function(shape,x,s){var that=this;switch(that.shape=shape,(null===x||void 0===x)&&(x=64),(null===s||void 0===s)&&(s=64),x>=480?(x=480,$("input#detail_value").val(480)):$("input#detail_value").val(that.detail),s>=480&&(s=480),that.meshUpdate===!0&&(that.geometry.verticesNeedUpdate=!1,that.geometry.dynamic=!1,that.geometry=null,that.videoMaterial.renderToScreen=!1,that.scene.remove(that.mesh)),shape){case"plane":if(that.hd===!0){var y=9*x/16;that.geometry=new THREE.PlaneGeometry(x,x,y,y)}else that.geometry=new THREE.PlaneGeometry(x,s,x,s);that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"sphere":that.geometry=new THREE.SphereGeometry(x,s,s),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"cube":(x>60||s>60)&&(x=s=60),that.geometry=new THREE.BoxGeometry(x,x,x,s,s,s),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"cylinder":that.geometry=new THREE.CylinderGeometry(2*that.scale,2*that.scale,8*x,s,x,!1),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"torus":that.geometry=new THREE.TorusGeometry(that.scale,x,x,x),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"ring":that.geometry=new THREE.RingGeometry(x,x,s,s),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"tetra":that.geometry=new THREE.TetrahedronGeometry(x,s),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"octa":that.geometry=new THREE.OctahedronGeometry(x,s),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;case"poly":that.geometry=new THREE.PolyhedronGeometry(x,s,that.scale,that.scale),that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial);break;default:if(that.hd===!0){var y=9*x/16;that.geometry=new THREE.PlaneGeometry(x,x,y,y)}else that.geometry=new THREE.PlaneGeometry(x,s,x,s);that.mesh=new THREE.Mesh(that.geometry,that.videoMaterial)}setTimeout(function(){that.meshUpdate=!0,that.scene.add(that.mesh),that.mesh.doubleSided=!0,that.mesh.position.x=that.mesh.position.y=that.mesh.position.z=0,that.mesh.scale.x=that.mesh.scale.y=that.mesh.scale.z=that.scale,that.geometry.dynamic=!0,that.geometry.verticesNeedUpdate=!0,that.videoMaterial.renderToScreen=!0},100)},removeMesh:function(mesh){var that=this;that.scene.remove(mesh)},addMesh:function(mesh){var that=this;that.scene.add(mesh)},onDocumentMouseMove:function(event){this.mouseX=event.clientX-this.windowHalfX,this.mouseY=.3*(event.clientY-this.windowHalfY)},render:function(){var that=this;this.videoInput.readyState===this.videoInput.HAVE_ENOUGH_DATA&&(this.texture&&(this.texture.needsUpdate=!0),this.videoMaterial&&(this.videoMaterial.needsUpdate=!0)),this.camera.lookAt(that.scene.position),this.paramsChange(),this.composer.render()}};